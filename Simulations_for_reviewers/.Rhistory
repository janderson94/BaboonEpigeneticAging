cor.test(tmp$simulated,tmp$Age..years.)
plot(tmp$dif~tmp$simulated,xlab="Simulated variable",ylab="Predicted epigenetic age- Chronological age",pch=20)
abline(lm(tmp$dif~tmp$simulated),lty=2)
text(33,-4,labels = "r=-0.32\np=0.0001")
cor.test(tmp$simulated,tmp$dif)
plot(tmp$Residual_epi_age~tmp$simulated,xlab="Simulated variable",ylab="Residual epigenetic age",pch=20)
abline(lm(tmp$Residual_epi_age~tmp$simulated),lty=2)
text(33,-3,labels = "r=-0.12\np=0.16")
cor.test(tmp$Residual_epi_age,tmp$simulated)
#BMI versus predicted Dif
tmp$dif<-tmp$Predicted.epigenetic.age..years..from.n.277.model-tmp$Age..years.
cor(tmp$Body.Mass.Index..kg.m2.,tmp$Age..years.,use="pairwise.complete.obs")
tmp$simulated<-simcor(x = tmp$Age..years.,ymean=mean(tmp$Body.Mass.Index..kg.m2.,na.rm = T),ysd=sd(tmp$Body.Mass.Index..kg.m2.,na.rm=T),correlation = 0.60)
#Simulate random correlated variable with age in N277 model
#Data will come loaded like this
tmp<-read.csv("~/Desktop/Anderson_et_al_2020_NatComm_Supplementary_Tables_1Oct20.csv")[1:277,]
tmp<-tmp[tmp$Sex=="M",]
#BMI versus predicted Dif
tmp$dif<-tmp$Predicted.epigenetic.age..years..from.n.277.model-tmp$Age..years.
cor(tmp$Body.Mass.Index..kg.m2.,tmp$Age..years.,use="pairwise.complete.obs")
tmp$simulated<-simcor(x = tmp$Age..years.,ymean=mean(tmp$Body.Mass.Index..kg.m2.,na.rm = T),ysd=sd(tmp$Body.Mass.Index..kg.m2.,na.rm=T),correlation = 0.60)
tmp$Residual_epi_age<-residuals(lm(tmp$Predicted.epigenetic.age..years..from.n.277.model~tmp$Age..years.))
par(mfrow=c(2,2),pty="s")
plot(tmp$simulated~tmp$Body.Mass.Index..kg.m2.,xlab="BMI",ylab="Simulated variable",pch=20)
abline(lm(tmp$simulated~tmp$Body.Mass.Index..kg.m2.),lty=2)
cor.test(tmp$Body.Mass.Index..kg.m2.,tmp$simulated)
plot(tmp$Age..years.~tmp$simulated,xlab="Simulated variable",ylab="Chronological age",pch=20)
abline(lm(tmp$Age..years.~tmp$simulated),lty=2)
cor.test(tmp$simulated,tmp$Age..years.)
plot(tmp$dif~tmp$simulated,xlab="Simulated variable",ylab="Predicted epigenetic age- Chronological age",pch=20)
abline(lm(tmp$dif~tmp$simulated),lty=2)
text(33,-4,labels = "r=-0.32\np=0.0001")
cor.test(tmp$simulated,tmp$dif)
plot(tmp$Residual_epi_age~tmp$simulated,xlab="Simulated variable",ylab="Residual epigenetic age",pch=20)
abline(lm(tmp$Residual_epi_age~tmp$simulated),lty=2)
text(33,-3,labels = "r=-0.12\np=0.16")
cor.test(tmp$Residual_epi_age,tmp$simulated)
summary(lm(tmp$Body.Mass.Index..kg.m2.~tmp$Age..years.))
plot(tmp$dif~tmp$Body.Mass.Index..kg.m2.,xlab="Body Mass Index",ylab="Predicted epigenetic age- Chronological age",main="Females",pch=20)
abline(lm(tmp$dif~tmp$Body.Mass.Index..kg.m2.),lty=2)
summary(lm(tmp$dif~tmp$Body.Mass.Index..kg.m2.))
cor.test(tmp$Body.Mass.Index..kg.m2.,tmp$dif,use = "pairwise.complete.obs")
text(x=25,y=-5,"r=-0.25\np=0.013")
#Simulate the variable 1000 times and take correlation with predicted-epi and residual epi
b1<-1:1000
b2<-1:1000
p1<-1:1000
p2<-1:1000
for(f in 1:1000){
s<-simcor(x = tmp$Age..years.,ymean=mean(tmp$Body.Mass.Index..kg.m2.,na.rm = T),ysd=sd(tmp$Body.Mass.Index..kg.m2.,na.rm=T),correlation = 0.60)
b1[f]<-cor(s,tmp$dif,use="pairwise.complete.obs")
b2[f]<-cor(s,tmp$Residual_epi_age,,use="pairwise.complete.obs")
p1[f]<-unlist(cor.test(s,tmp$dif,use="pairwise.complete.obs")[3])
p2[f]<-unlist(cor.test(s,tmp$Residual_epi_age,use="pairwise.complete.obs")[3])
}
par(mfrow=c(1,2),pty="s")
col<-rep("Black",1000)
col[p1<.05]<-"Dark Blue"
col[p1<.1 & p1>.05]<-"#70869E"
hist(b1,xlab="Pearson's r",breaks=100,main="Simulated variable vs (Predicted age- Chronological age)")
abline(v=cor(tmp$Body.Mass.Index..kg.m2.,tmp$dif,use="pairwise.complete.obs"))
hist(b2,xlab="Pearson's r",breaks=100,main="Simulated variable vs Residual epi age")
#Visualize results
library(ggplot2)
ggplot(data=dif,aes(b1,col=p1))+geom_histogram()
ggplot()+geom_histogram(aes(b1,col=p1))
cols<-p1
cols[cols<.05]<-"Steel Blue"
cols[cols>.05 & cols <.1]<-"#70869E"
cols[cols>.1]<-"Black"
ggplot()+geom_histogram(aes(b1,col=cols))
ggplot()+geom_histogram(aes(b1,fill=cols))
ggplot()+geom_histogram(aes(b1,fill=cols),alpha=0.5)
ggplot()+geom_histogram(aes(b1,fill=cols,group=cols]),alpha=0.5,)
ggplot()+geom_histogram(aes(b1,fill=cols,group=cols),alpha=0.5,)
ggplot()+geom_histogram(aes(b1,fill=cols,group=cols),alpha=0.5)
ggplot()+geom_histogram(aes(b1,fill=cols,group=cols),alpha=0.5)+scale_fill_manual(values=cols)
ggplot()+geom_histogram(aes(b1,fill=cols,group=cols),alpha=0.5)+scale_fill_manual(values=unique(cols))
cols<-p1
cols[cols<.05]<-"Steel Blue"
cols[cols>.05 & cols <.1]<-"#70869E"
cols[cols>.1]<-"Black"
table(cols)
cols[cols<.05]<-"Steel Blue"
cols<-p1
cols[cols<.05]<-"Steel Blue"
cols<-p1
cols[cols<.05]<-"Steel Blue"
cols[which(cols>.05 & cols <.1)]<-"#70869E"
cols[which(cols>.1]<-"Black"
cols[which(cols>.1)]<-"Black"
cols<-p1
cols[cols<.05]<-"Steel Blue"
cols[which(cols>.05 & cols <.1)]<-"#70869E"
cols[which(cols>.1)]<-"Black"
ggplot()+geom_histogram(aes(b1,fill=cols,group=cols),alpha=0.5)+scale_fill_manual(values=unique(cols))
ggplot()+geom_histogram(aes(b1,fill=cols,group=cols),alpha=0.5)+scale_fill_manual(values=cols))
ggplot()+geom_histogram(aes(b1,fill=cols,group=cols),alpha=0.5)+scale_fill_manual(values=cols)
cols<-p1
cols[which(cols<.05)]<-"Steel Blue"
cols[which(cols>.05 & cols <.1)]<-"#70869E"
cols[which(cols>.1)]<-"Black"
table(cols)
cols[which(cols<.05)]<-"Steel Blue"
cols
cols<-p1
length(which(cols<.05))
length(which(cols>.05 & cols <.1))
length(which(cols>.1))
cols<-p1
cols[which(cols<.05)]<-"Steel Blue"
cols[which(cols>.05 & cols <.1)]<-"#70869E"
cols[which(cols>.1)]<-"Black"
par(mfrow=c(1,2),pty="s")
library(scales)
tmp$dif<-tmp$Predicted.epigenetic.age..years..from.n.277.model-tmp$Age..years.
hist(b1[p1>.1],xlab="Pearson's r",breaks=25,main="Simulated variable vs (Predicted age- Chronological age)",
xlim=c(min(b1),max(b1)),col=alpha("Black",alpha=.6),ylim=c(0,35))
par(new=TRUE)
hist(b1[p1<.05],xlab="Pearson's r",breaks=100,main="",
xlim=c(min(b1),max(b1)),col=alpha("Steel Blue",alpha=.6),ylim=c(0,35))
par(new=TRUE)
hist(b1[p1<.1 & p1>.05],xlab="Pearson's r",breaks=5,main="",
xlim=c(min(b1),max(b1)),col=alpha("#70869E",alpha=.6),ylim=c(0,35))
hist(b2[p2>.1],xlab="Pearson's r",breaks=25,main="Simulated variable vs Residual epi age",
xlim=c(min(b2),max(b2)),col=alpha("Black",alpha=.6),ylim=c(0,60))
par(new=TRUE)
hist(b2[p2<.05],xlab="Pearson's r",breaks=100,main="",
xlim=c(min(b2),max(b2)),col=alpha("Steel Blue",alpha=.6),ylim=c(0,60))
abline(v=cor(tmp$Body.Mass.Index..kg.m2.,tmp$Residual_epi_age,use="pairwise.complete.obs"),lwd=3,lty=2)
par(new=TRUE)
hist(b2[p2>.05 & p2<.1],xlab="Pearson's r",breaks=25,main="",
xlim=c(min(b2),max(b2)),col=alpha("#70869E",alpha=.6),ylim=c(0,60))
abline(v=cor(tmp$Body.Mass.Index..kg.m2.,tmp$Residual_epi_age,use="pairwise.complete.obs"),lwd=3,lty=2)
tmp$Residual_epi_age<-residuals(lm(tmp$dif~tmp$Age..years.))
tmp$Residual_epi_age<-residuals(lm(tmp$dif~tmp$Age..years.))
#Visualize results
#Colored by significance
#First plot a histogram of the correlation between the simulated variable and delta age (i.e. predicted- chronological age)
par(mfrow=c(1,2),pty="s")
library(scales)
tmp$dif<-tmp$Predicted.epigenetic.age..years..from.n.277.model-tmp$Age..years.
simcor <- function (x, ymean=MEAN, ysd=SD, correlation=0) {
#What a vector of the same length
n <- length(x)
#Draw from a normal distribution based on specified mean and SD
y <- rnorm(n,mean = ymean,sd=ysd)
#Take the vector of interest, scaled to mean 0, var 1, rescaled by the correlation
#Add Randomly distributed noise scaled by 1-correlation
#Result will be mean 0, var 1 vector
z <- correlation * scale(x)[,1] + sqrt(1 - correlation^2) * scale(resid(lm(y ~ x)))[,1]
#Rescale by desired sd and add to desired mean
yresult <- ymean + ysd * z
return(yresult)
}
#Simulate random correlated variable with age in N277 model
#Data will come loaded like this
tmp<-read.csv("~/Desktop/Anderson_et_al_2020_NatComm_Supplementary_Tables_1Oct20.csv")[1:277,]
tmp<-tmp[tmp$Sex=="M",]
#BMI versus predicted Dif
tmp$dif<-tmp$Predicted.epigenetic.age..years..from.n.277.model-tmp$Age..years.
cor(tmp$Body.Mass.Index..kg.m2.,tmp$Age..years.,use="pairwise.complete.obs")
tmp$simulated<-simcor(x = tmp$Age..years.,ymean=mean(tmp$Body.Mass.Index..kg.m2.,na.rm = T),ysd=sd(tmp$Body.Mass.Index..kg.m2.,na.rm=T),correlation = 0.60)
tmp$Residual_epi_age<-residuals(lm(tmp$dif~tmp$Age..years.))
par(mfrow=c(2,2),pty="s")
plot(tmp$simulated~tmp$Body.Mass.Index..kg.m2.,xlab="BMI",ylab="Simulated variable",pch=20)
abline(lm(tmp$simulated~tmp$Body.Mass.Index..kg.m2.),lty=2)
cor.test(tmp$Body.Mass.Index..kg.m2.,tmp$simulated)
plot(tmp$Age..years.~tmp$simulated,xlab="Simulated variable",ylab="Chronological age",pch=20)
abline(lm(tmp$Age..years.~tmp$simulated),lty=2)
cor.test(tmp$simulated,tmp$Age..years.)
plot(tmp$dif~tmp$simulated,xlab="Simulated variable",ylab="Predicted epigenetic age- Chronological age",pch=20)
abline(lm(tmp$dif~tmp$simulated),lty=2)
text(33,-4,labels = "r=-0.32\np=0.0001")
cor.test(tmp$simulated,tmp$dif)
plot(tmp$Residual_epi_age~tmp$simulated,xlab="Simulated variable",ylab="Residual epigenetic age",pch=20)
abline(lm(tmp$Residual_epi_age~tmp$simulated),lty=2)
text(33,-3,labels = "r=-0.12\np=0.16")
cor.test(tmp$Residual_epi_age,tmp$simulated)
summary(lm(tmp$Body.Mass.Index..kg.m2.~tmp$Age..years.))
for(f in 1:1000){
s<-simcor(x = tmp$Age..years.,ymean=mean(tmp$Body.Mass.Index..kg.m2.,na.rm = T),ysd=sd(tmp$Body.Mass.Index..kg.m2.,na.rm=T),correlation = 0.60)
b1[f]<-cor(s,tmp$dif,use="pairwise.complete.obs")
b2[f]<-cor(s,tmp$Residual_epi_age,,use="pairwise.complete.obs")
p1[f]<-unlist(cor.test(s,tmp$dif,use="pairwise.complete.obs")[3])
p2[f]<-unlist(cor.test(s,tmp$Residual_epi_age,use="pairwise.complete.obs")[3])
}
#Simulate the variable 1000 times and take correlation with predicted-epi and residual epi
b1<-1:1000
b2<-1:1000
p1<-1:1000
p2<-1:1000
#Simulate the variable 1000 times and take correlation with predicted-epi and residual epi
b1<-1:1000
b2<-1:1000
p1<-1:1000
p2<-1:1000
for(f in 1:1000){
s<-simcor(x = tmp$Age..years.,ymean=mean(tmp$Body.Mass.Index..kg.m2.,na.rm = T),ysd=sd(tmp$Body.Mass.Index..kg.m2.,na.rm=T),correlation = 0.60)
b1[f]<-cor(s,tmp$dif,use="pairwise.complete.obs")
b2[f]<-cor(s,tmp$Residual_epi_age,,use="pairwise.complete.obs")
p1[f]<-unlist(cor.test(s,tmp$dif,use="pairwise.complete.obs")[3])
p2[f]<-unlist(cor.test(s,tmp$Residual_epi_age,use="pairwise.complete.obs")[3])
}
#Visualize results
#Colored by significance
#First plot a histogram of the correlation between the simulated variable and delta age (i.e. predicted- chronological age)
par(mfrow=c(1,2),pty="s")
par(mfrow=c(1,2),pty="s")
tmp$dif<-tmp$Predicted.epigenetic.age..years..from.n.277.model-tmp$Age..years.
hist(b1[p1>.1],xlab="Pearson's r",breaks=25,main="Simulated variable vs (Predicted age- Chronological age)",
xlim=c(min(b1),max(b1)),col=alpha("Black",alpha=.6),ylim=c(0,35))
par(new=TRUE)
hist(b1[p1<.05],xlab="Pearson's r",breaks=100,main="",
xlim=c(min(b1),max(b1)),col=alpha("Steel Blue",alpha=.6),ylim=c(0,35))
par(new=TRUE)
hist(b1[p1<.1 & p1>.05],xlab="Pearson's r",breaks=5,main="",
xlim=c(min(b1),max(b1)),col=alpha("#70869E",alpha=.6),ylim=c(0,35))
#Dashed line indicates the strength of the observed correlation between BMI and delta age
abline(v=cor(tmp$Body.Mass.Index..kg.m2.,tmp$dif,use="pairwise.complete.obs"),lty=2,lwd=3)
#Plot the same results but from when we regress the age structure out of delta age first.
hist(b2[p2>.1],xlab="Pearson's r",breaks=25,main="Simulated variable vs Residual epi age",
xlim=c(min(b2),max(b2)),col=alpha("Black",alpha=.6),ylim=c(0,60))
par(new=TRUE)
hist(b2[p2<.05],xlab="Pearson's r",breaks=100,main="",
xlim=c(min(b2),max(b2)),col=alpha("Steel Blue",alpha=.6),ylim=c(0,60))
abline(v=cor(tmp$Body.Mass.Index..kg.m2.,tmp$Residual_epi_age,use="pairwise.complete.obs"),lwd=3,lty=2)
par(new=TRUE)
hist(b2[p2>.05 & p2<.1],xlab="Pearson's r",breaks=25,main="",
xlim=c(min(b2),max(b2)),col=alpha("#70869E",alpha=.6),ylim=c(0,60))
abline(v=cor(tmp$Body.Mass.Index..kg.m2.,tmp$Residual_epi_age,use="pairwise.complete.obs"),lwd=3,lty=2)
####################################
#Simulations for reviewers
####################################
tmp<-read.table("~/Desktop/info_n277.txt")
####################################
#Simulations for reviewers
####################################
tmp<-read.table("~/Desktop/info_n277.txt",header=T)
View(tmp)
tmp[tmp$sex=="M",]
tmp<-tmp[tmp$sex=="M",]
save.image()
View(tmp)
####################################
#Simulations for reviewers
####################################
tmp<-read.csv("~/Desktop/Anderson_et_al_2020_NatComm_Supplementary_Tables_1Oct20.csv")
####################################
#Simulations for reviewers
####################################
tmp<-read.csv("~/Desktop/Anderson_et_al_2020_NatComm_Supplementary_Tables_1Oct20.csv")[1:277,]
tmp[tmp$Sex=="M",]
tmp<-tmp[tmp$Sex=="M",]
View(tmp)
simcor <- function (x, ymean=MEAN, ysd=SD, correlation=0) {
#What a vector of the same length
n <- length(x)
#Draw from a normal distribution based on specified mean and SD
y <- rnorm(n,mean = ymean,sd=ysd)
#Take the vector of interest, scaled to mean 0, var 1, rescaled by the correlation
#Add Randomly distributed noise scaled by 1-correlation
#Result will be mean 0, var 1 vector
z <- correlation * scale(x)[,1] + sqrt(1 - correlation^2) * scale(resid(lm(y ~ x)))[,1]
#Rescale by desired sd and add to desired mean
yresult <- ymean + ysd * z
return(yresult)
}
#Simulate random correlated variable with age in N277 model
head(tmp)
#
data<-tmp
head(data)
data$Predicted.epigenetic.age..years..from.n.286.model<-NULL
data$Depth..millions.of.reads.sequenced.<-NULL
data$Bisulfite.conversion.rate<-NULL
data$Dyadic.Social.Connectedness..F.to.F.
data$Dyadic.Social.Connectedness..F.to.F.<-NULL
data$Sequencing.Platform<-NULL
data$Accuracy.of.birth.date<-NULL
View(data)
data$Cumulative.Early.Adversity.Score<-NULL
head(data)
colnames(data)
colnames(data)[8]<-"Predicted_age"
colnames(data)[8]<-"predicted_age"
colnames(data)[6]<-"BMI"
colnames(data)[4]<-"Rank"
colnames(data)[3]<-"Age"
head(data)
rm(tmp)
##The Data Frame "data" loaded in here is a slice of SI Table 1
#It focuses on males from the main N=277 model
load("./.RData")
##The Data Frame "data" loaded in here is a slice of SI Table 1
#It focuses on males from the main N=277 model
load("./.RData")
head(data)
head(data)
data$delta_age<-data$predicted_age-data$Age
colnames(data)
colnames(data)[3]<-"age"
colnames(data)[4]<-"rank"
colnames(data)[5]<-"sex"
head(data)
colnames(data)[6]
colnames(data)[7]
colnames(data)[7]<-"age.adjusted.BMI"
head(data)
#Here we show that if a variable is correlated with chronological age, like raw BMI is,
#then age bias in delta age must be account for.
#For example
par(mfrow=c(1,1),pty="s")
plot(data$delta_age~data$age)
plot(data$delta_age~data$age,pch=20,xlab="Chronological age (years)",ylab="Delta age")
#Here we show that if a variable is correlated with chronological age, like raw BMI is,
#then age bias in delta age must be account for.
#For example
par(mfrow=c(1,1),pty="s",cex=1.5)
plot(data$delta_age~data$age,pch=20,xlab="Chronological age (years)",ylab="Delta age")
abline(lm(data$delta_age~data$age),lty=2)
plot(data$delta_age~data$BMI,pch=20,xlab="Chronological age (years)",ylab="Delta age")
#Here we see the strong age bias in our delta age predictions, such that older individuals tend to be underestimated
#i.e. they tend to have a negative delta age (Predicted-chronological age)
plot(data$age~data$BMI)
#Here we see the strong age bias in our delta age predictions, such that older individuals tend to be underestimated
#i.e. they tend to have a negative delta age (Predicted-chronological age)
plot(data$BMI~data$age)
#Here we see the strong age bias in our delta age predictions, such that older individuals tend to be underestimated
#i.e. they tend to have a negative delta age (Predicted-chronological age)
plot(data$BMI~data$age,pch=20)
#Here we see the strong age bias in our delta age predictions, such that older individuals tend to be underestimated
#i.e. they tend to have a negative delta age (Predicted-chronological age)
plot(data$BMI~data$age,pch=20,xlab="Chronological age (years)",ylab="BMI")
#The age structure in delta age and BMI produce a correlation
plot(data$delta_age~data$BMI,pch=20,xlab="Chronological age (years)",ylab="Delta age")
cor(data$BMI,data$age,use="pairwise.complete.obs")
data$Residual_epi_age<-residuals(lm(data$delta_age~data$age))
data$Residual_epi_age<-residuals(lm(data$delta_age~data$age))
#Lets simulate one, random variable as outlined above.
tmp$simulated<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
View(data)
#Lets simulate one, random variable as outlined above.
data$simulated<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
par(mfrow=c(2,2),pty="s")
plot(tmp$simulated~tmp$Body.Mass.Index..kg.m2.,xlab="BMI",ylab="Simulated variable",pch=20)
par(mfrow=c(2,2),pty="s")
plot(data$simulated~data$Body.Mass.Index..kg.m2.,xlab="BMI",ylab="Simulated variable",pch=20)
plot(data$simulated~data$BMI,xlab="BMI",ylab="Simulated variable",pch=20)
abline(lm(data$simulated~data$Body.Mass.Index..kg.m2.),lty=2)
abline(lm(data$simulated~data$Body.Mass.Index..kg.m2.),lty=2)
cor.test(data$Body.Mass.Index..kg.m2.,data$simulated)
cor.test(data$BMI,data$simulated)
plot(data$age~data$simulated,xlab="Simulated variable",ylab="Chronological age",pch=20)
par(mfrow=c(1,3),pty="s")
plot(data$age~data$simulated,xlab="Simulated variable",ylab="Chronological age",pch=20)
cor.test(data$simulated,data$ag)
cor.test(data$simulated,data$age)
plot(data$delta_age~data$simulated,xlab="Simulated variable",ylab="Predicted epigenetic age- Chronological age",pch=20)
abline(lm(data$dif~data$simulated),lty=2)
cor.test(data$simulated,data$dif)
#Lets simulate one, random variable as outlined above.
set.seed(1)
data$simulated<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
data$simulated
#Lets simulate one, random variable as outlined above.
set.seed()
data$simulated<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
#Lets simulate one, random variable as outlined above.
set.seed(1)
data$simulated<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
#Lets simulate one, random variable as outlined above.
set.seed(1)
data$simulated<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
data$simulated
data$simulated<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
data$simulated
#Lets simulate one, random variable as outlined above.
set.seed(1)
data$simulated<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
data$simulated
#Lets simulate one, random variable as outlined above.
set.seed(1)
data$simulated<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
par(mfrow=c(1,3),pty="s")
plot(data$age~data$simulated,xlab="Simulated variable",ylab="Chronological age",pch=20)
#As expected, the simulated variable and age have a correlation of 0.6
cor.test(data$simulated,data$age)
plot(data$delta_age~data$simulated,xlab="Simulated variable",ylab="Predicted epigenetic age- Chronological age",pch=20)
abline(lm(data$delta_age~data$simulated),lty=2)
cor.test(data$simulated,data$dif)
cor.test(data$simulated,data$delta_age)
#Lets simulate one, random variable as outlined above.
set.seed(10)
data$simulated<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
par(mfrow=c(1,3),pty="s")
plot(data$age~data$simulated,xlab="Simulated variable",ylab="Chronological age",pch=20)
cor.test(data$simulated,data$age)
#As expected, the simulated variable and age have a correlation of 0.6
plot(data$delta_age~data$simulated,xlab="Simulated variable",ylab="Predicted epigenetic age- Chronological age",pch=20)
abline(lm(data$delta_age~data$simulated),lty=2)
cor.test(data$simulated,data$delta_age)
#We also see that the simulated variable and delta age are strongly, negatively correlated (as is BMI and delta age)
plot(data$delta_age~data$simulated,xlab="Simulated variable",ylab="Predicted epigenetic age- Chronological age",pch=20)
par(mfrow=c(1,3),pty="s")
plot(data$age~data$simulated,xlab="Simulated variable",ylab="Chronological age",pch=20)
cor.test(data$simulated,data$age)
#We also see that the simulated variable and delta age are strongly, negatively correlated (as is BMI and delta age)
plot(data$delta_age~data$simulated,xlab="Simulated variable",ylab="Predicted epigenetic age- Chronological age",pch=20)
cor.test(data$simulated,data$delta_age)
#Finally, using residual epigenetic age (delta age controlling for the age bias in predictions by regressing age out from delta age and taking the residuals),
#We find no relationship between the simulated variable and residual epigenetic age
plot(data$Residual_epi_age~data$simulated,xlab="Simulated variable",ylab="Residual epigenetic age",pch=20)
cor.test(data$Residual_epi_age,data$simulated)
cor.test(data$Residual_epi_age,data$simulated)
#Simulate the variable 1000 times and take correlation with predicted-epi and residual epi
b1<-1:1000
b2<-1:1000
p1<-1:1000
p2<-1:1000
#Simulate the variable 1000 times and take correlation with predicted-epi and residual epi
b1<-1:1000
b2<-1:1000
p1<-1:1000
p2<-1:1000
for(f in 1:1000){
s<-simcor(x = data$age,ymean=mean(data$BMI,na.rm = T),ysd=sd(data$BMI,na.rm=T),correlation = 0.60)
b1[f]<-cor(s,data$delta_age,use="pairwise.complete.obs")
b2[f]<-cor(s,data$Residual_epi_age,,use="pairwise.complete.obs")
p1[f]<-unlist(cor.test(s,data$delta_age,use="pairwise.complete.obs")[3])
p2[f]<-unlist(cor.test(s,data$Residual_epi_age,use="pairwise.complete.obs")[3])
}
#Visualize results
#Colored by significance
#First plot a histogram of the correlation between the simulated variable and delta age (i.e. predicted- chronological age)
library(scales)
par(mfrow=c(1,2),pty="s")
data$dif<-data$Predicted.epigenetic.age..years..from.n.277.model-data$Age..years.
View(data)
head(data)
par(mfrow=c(1,2),pty="s")
hist(b1[p1>.1],xlab="Pearson's r",breaks=25,main="Simulated variable vs (Predicted age- Chronological age)",
xlim=c(min(b1),max(b1)),col=alpha("Black",alpha=.6),ylim=c(0,35))
par(new=TRUE)
hist(b1[p1<.05],xlab="Pearson's r",breaks=100,main="",
xlim=c(min(b1),max(b1)),col=alpha("Steel Blue",alpha=.6),ylim=c(0,35))
par(new=TRUE)
hist(b1[p1<.1 & p1>.05],xlab="Pearson's r",breaks=5,main="",
xlim=c(min(b1),max(b1)),col=alpha("#70869E",alpha=.6),ylim=c(0,35))
#Dashed line indicates the strength of the observed correlation between BMI and delta age
abline(v=cor(data$Body.Mass.Index..kg.m2.,data$dif,use="pairwise.complete.obs"),lty=2,lwd=3)
#Dashed line indicates the strength of the observed correlation between BMI and delta age
abline(v=cor(data$BMI,data$delta_age,use="pairwise.complete.obs"),lty=2,lwd=3)
par(mfrow=c(1,2),pty="s")
hist(b1[p1>.1],xlab="Pearson's r",breaks=25,main="Simulated variable vs (Predicted age- Chronological age)",
xlim=c(min(b1),max(b1)),col=alpha("Black",alpha=.6),ylim=c(0,35))
par(new=TRUE)
hist(b1[p1<.05],xlab="Pearson's r",breaks=50,main="",
xlim=c(min(b1),max(b1)),col=alpha("Steel Blue",alpha=.6),ylim=c(0,35))
par(new=TRUE)
hist(b1[p1<.1 & p1>.05],xlab="Pearson's r",breaks=5,main="",
xlim=c(min(b1),max(b1)),col=alpha("#70869E",alpha=.6),ylim=c(0,35))
#Dashed line indicates the strength of the observed correlation between BMI and delta age
abline(v=cor(data$BMI,data$delta_age,use="pairwise.complete.obs"),lty=2,lwd=3)
length(which(b1<.05))
length(which(p1<.05))
#Plot the same results but from when we regress the age structure out of delta age first.
hist(b2[p2>.1],xlab="Pearson's r",breaks=25,main="Simulated variable vs Residual epi age",
xlim=c(min(b2),max(b2)),col=alpha("Black",alpha=.6),ylim=c(0,60))
par(new=TRUE)
hist(b2[p2<.05],xlab="Pearson's r",breaks=100,main="",
xlim=c(min(b2),max(b2)),col=alpha("Steel Blue",alpha=.6),ylim=c(0,60))
abline(v=cor(data$Body.Mass.Index..kg.m2.,data$Residual_epi_age,use="pairwise.complete.obs"),lwd=3,lty=2)
par(new=TRUE)
par(new=TRUE)
hist(b2[p2>.05 & p2<.1],xlab="Pearson's r",breaks=25,main="",
xlim=c(min(b2),max(b2)),col=alpha("#70869E",alpha=.6),ylim=c(0,60))
#Plot the same results but from when we regress the age structure out of delta age first.
hist(b2[p2>.1],xlab="Pearson's r",breaks=25,main="Simulated variable vs Residual epi age",
xlim=c(min(b2),max(b2)),col=alpha("Black",alpha=.6),ylim=c(0,60))
par(mfrow=c(1,2),pty="s")
hist(b1[p1>.1],xlab="Pearson's r",breaks=25,main="Simulated variable vs (Predicted age- Chronological age)",
xlim=c(min(b1),max(b1)),col=alpha("Black",alpha=.6),ylim=c(0,35))
par(new=TRUE)
hist(b1[p1<.05],xlab="Pearson's r",breaks=50,main="",
xlim=c(min(b1),max(b1)),col=alpha("Steel Blue",alpha=.6),ylim=c(0,35))
par(new=TRUE)
hist(b1[p1<.1 & p1>.05],xlab="Pearson's r",breaks=5,main="",
xlim=c(min(b1),max(b1)),col=alpha("#70869E",alpha=.6),ylim=c(0,35))
#Dashed line indicates the strength of the observed correlation between BMI and delta age
abline(v=cor(data$BMI,data$delta_age,use="pairwise.complete.obs"),lty=2,lwd=3)
#Many of the 1,000 simulated variables are significantly associated with delta age at a nominal p-value of 0.05
length(which(p1<.05))
#Plot the same results but from when we regress the age structure out of delta age first.
hist(b2[p2>.1],xlab="Pearson's r",breaks=25,main="Simulated variable vs Residual epi age",
xlim=c(min(b2),max(b2)),col=alpha("Black",alpha=.6),ylim=c(0,60))
par(new=TRUE)
hist(b2[p2<.05],xlab="Pearson's r",breaks=50,main="",
xlim=c(min(b2),max(b2)),col=alpha("Steel Blue",alpha=.6),ylim=c(0,60))
par(new=TRUE)
hist(b2[p2>.05 & p2<.1],xlab="Pearson's r",breaks=25,main="",
xlim=c(min(b2),max(b2)),col=alpha("#70869E",alpha=.6),ylim=c(0,60))
#Dashed line indicates the strength of the observed correlation between BMI and residual epi age
abline(v=cor(data$BMI,data$Residual_epi_age,use="pairwise.complete.obs"),lwd=3,lty=2)
#Far fewer of the 1,000 simulated variables are significantly associated with delta age at a nominal p-value of 0.05
length(which(p2<.05))
15/1000
version()
sessionInfo()
rm(b1,b2,f,p1,p2,s)
my_session<-sessionInfo()
my_session
